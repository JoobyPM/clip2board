# clip2drive

clip2drive is a command-line tool for macOS that streamlines the process of saving text from your clipboard as a Markdown (.md) file to Google Drive. It automates the uploading process, sets the file sharing permissions to “Anyone with the link can view,” and replaces the content in your clipboard with the shareable link to the uploaded file.


## Features

 - Clipboard Integration: Reads text directly from your clipboard.
 - Markdown Support: Saves the clipboard content as a Markdown file.
 - Google Drive Upload: Uploads the file to a specified Google Drive folder.
 - Automatic Sharing: Sets file permissions to allow viewing by anyone with the link.
 - Link Replacement: Replaces your clipboard content with the shareable Google Drive link.
 - Hotkey Support: Easily trigger the tool using a custom keyboard shortcut.
 - llama3.2 (Ollama) integration: Autogenerated the name of the file based on the content of the clipboard.

## Use Case

As a frequent user of ChatGPT, you might often find yourself copying responses, reformatting them, and then uploading them to Google Drive to share with colleagues. This repetitive task can be time-consuming and cumbersome.

clip2drive simplifies this process:

 - Step 1: Copy the ChatGPT response to your clipboard.
 - Step 2: Use a pre-configured hotkey to run clip2drive.
 - Result: The content is automatically uploaded to Google Drive, and the shareable link is copied to your clipboard, ready to be shared.

This eliminates the need to manually create a document, paste the content, format it, upload it to Google Drive, and adjust sharing settings.

## Motivation
As a Team Lead and Project Manager, I often rely on ChatGPT to generate blueprint documents, typically 1-2 times a day. 
However, the process of copying the output, pasting it into Google Docs or another editor, and manually converting it into the desired format takes considerable effort. 
On average, this task requires 5 to 15 minutes per document to properly edit, upload, and share through Google Docs. 
I discovered that if I copy the response from ChatGPT into a Markdown (MD) file, upload it to Google Drive, and then open it using Google Docs, 
the formatting is almost as good as the original ChatGPT output. This approach significantly reduces my editing time to just 2-5 minutes per document.

This realization led me to create a tool—clip2drive—to automate the entire process and save myself valuable time. 
By using my programming knowledge and some assistance from ChatGPT, I built this tool to streamline the workflow. 
I estimate that it could save me between 12 and 40 hours annually. Developing it took about 2 hours, plus 1 additional hour for setting up GitHub and writing documentation. 
I hope that this tool might be equally useful to others in similar roles who face the same repetitive challenges.

## Prerequisites

 - macOS: This tool is designed to work on macOS terminals.
 - Google API Credentials: CLIENT_ID and CLIENT_SECRET from Google Cloud Console.
 - Google Drive Folder ID: The ID of the Google Drive folder where files will be uploaded.
 - Bun.js: A fast JavaScript runtime. Install Bun.js if you haven’t already (`install.sh` can try to install it automatically).

## Installation (Automatic)

To make the installation process easier, you can use the provided install.sh script, which automates the installation and configuration of clip2drive. This script handles everything from cloning the repository to setting up the environment and building the executable.

### Step-by-Step Guide

 1. Download and Run the Installation Script:
First, download the install.sh script or clone the repository:

```shell
git clone https://github.com/JoobyPM/clip2drive.git
cd clip2drive
```

Run the installation script:
```shell
./install.sh
```


2. Optional: Specify Environment Variables:
You can provide the path to an environment file using the -e option if you have a .env file with your credentials:

```shell
./install.sh -e /path/to/your/.env
```
If you do not provide an environment file, the script will look for a .env file in the current directory. If no .env file is found, it will prompt you to enter your `CLIENT_ID`, `CLIENT_SECRET`, and `FOLDER_ID` manually.

3. What the Script Does:
 - Clone or Update the Repository: If you run the script from the cloned project directory, it will ask if you want to update the project. If not, it will clone the repository for you.
 - Install Dependencies: Installs Bun.js and other dependencies required for clip2drive.
 - Inject Credentials: Credentials (`CLIENT_ID`, `CLIENT_SECRET`, `FOLDER_ID`) are injected into the code, and the credentials are obfuscated using base64 encoding.
 - Build the Script: The script is built and bundled using Bun.js.
 - Set Up the Executable: The script is made executable and moved to `/usr/local/bin/clip2drive` for easy access.
4. Create Automator Quick Action (Optional but Recommended):
To make the usage more convenient, create a macOS Automator Quick Action:
- Open Automator (Applications > Automator).
- Choose “Quick Action”.
- Set “Workflow receives” to “no input” in “any application”.
- From the Actions library, add “Run Shell Script” to the workflow.
- Set Shell to "/bin/bash" and Pass input to “as arguments”.
- Enter the following command:
```shell
export PATH="$HOME/.bun/bin:$PATH"
/usr/local/bin/clip2drive >> ~/clip2drive.log
```


- Save the Quick Action as “clip2drive”.
- Assign a hotkey via System Preferences > Keyboard > Shortcuts for easy access.

5. Authentication:
During installation, clip2drive will run and prompt you to authenticate with your Google Account in your default browser. This is necessary to give clip2drive access to upload files to Google Drive.
6. Completion:
Once installation is complete, you will be able to use clip2drive from the command line or by using the hotkey you configured in Automator. The tool will upload clipboard content to Google Drive as a Markdown file and replace your clipboard with the shareable link.

#### Notes:
- Make sure you have the following installed and set up before running install.sh:
- Bun.js (The script will attempt to install it automatically if it is not already installed).
- Google API Credentials: CLIENT_ID and CLIENT_SECRET obtained from the Google Cloud Console.
- Google Drive Folder ID: The ID of the Google Drive folder where the files will be uploaded.
- Ensure you run the script with appropriate permissions. If necessary, you may need to run the installation commands with sudo.

With the automatic installation script, you can quickly set up clip2drive and start using it to organize and share your clipboard content on Google Drive efficiently.

## Manual Installation

1. Install Bun.js

If you haven’t installed Bun.js yet, run:

```shell
curl https://bun.sh/install | bash
```
Follow the on-screen instructions to complete the installation.

2. Clone the Repository
```shell
git clone https://github.com/JoobyPM/clip2drive.git
cd clip2drive
```

3. Install Dependencies

```shell
bun install
```

This command will install the required packages:
 - googleapis
 - clipboardy
 - dotenv
 - open

4. Add Execution Permission

Add a shebang line to the top of index.js and make it executable:

a. Make the Script Executable
```shell
chmod +x index.js
```

5. (Optional) Add to PATH

For easy access, you can rename index.js to clip2drive and move it to a directory in your PATH, such as /usr/local/bin:
```shell
mv index.js clip2drive
sudo mv clip2drive /usr/local/bin/
```

Now you can run the tool from anywhere using clip2drive.

## Getting Google API Credentials

1. Create a Google Cloud Project

   - Visit the Google Cloud Console.
   - Click on Select a project > New Project.
   - Enter a project name (e.g., clip2drive) and click Create.
   - Make sure your new project is selected in the top navigation bar.

2. Enable Google Drive API

   - In the Cloud Console, navigate to APIs & Services > Library.
   - Search for Google Drive API.
   - Click on Google Drive API and then Enable.

3. Create OAuth 2.0 Credentials

   - Go to APIs & Services > Credentials.
   - Click Create Credentials > OAuth client ID.
   - For Application Type, select Desktop app.
   - Provide a name (e.g., clip2drive Desktop App) and click Create.
   - You will be presented with your CLIENT_ID and CLIENT_SECRET.
   - Important: Download the credentials as a JSON file for backup.

Update Authorized Redirect URIs

 - While still in the Credentials section, click on your newly created OAuth client to edit it.
 - Under Authorized redirect URIs, add: http://localhost:3000
 - Save your changes.

## Setting Up Environment Variables

Create a .env file in the root directory of the project:
```shell
touch .env
```

Open the .env file in a text editor and add the following variables:
```shell
CLIENT_ID=your_google_client_id
CLIENT_SECRET=your_google_client_secret
FOLDER_ID=your_google_drive_folder_id
```

> Note:
> Replace placeholders like your_google_client_id, your_google_client_secret, and your_google_drive_folder_id with your actual credentials and folder ID.


Obtaining Google Drive Folder ID

 - Navigate to Google Drive.
 - Create a new folder or use an existing one.
 - Open the folder.
 - The URL will look like https://drive.google.com/drive/folders/your_folder_id.
 - Copy the your_folder_id part from the URL.
 - Paste it into your .env file as the value for `FOLDER_ID`.

## Usage

Running the Tool Manually

Run the Tool

```shell
bun index.js
```

(Or clip2drive if you added it to your PATH.)

### How It Works

 1. Authentication Prompt: The first time you run the tool, it will prompt you to authenticate your Google account.
   - A URL will be opened in your default browser.
   - Grant the requested permissions.
   - The browser will display a success message.
   - The tool captures the authentication code automatically.
 2. Clipboard Reading: The tool reads the current text from your clipboard.
 3. File Creation and Upload:
   - Saves the text as a Markdown file named Note-{timestamp}.md.
   - Uploads the file to the specified Google Drive folder.
 4. Sharing Settings: Automatically sets the file’s permissions to allow anyone with the link to view it.
 5. Clipboard Update: Replaces your clipboard content with the shareable Google Drive link.
 6. Completion Message: Displays a success message with the link to the uploaded file.

## Example

```
$ clip2drive
Opening the browser for authentication...
Waiting for authentication...
Token stored to /path/to/token.json
File uploaded successfully. Link copied to clipboard: https://drive.google.com/file/d/...
```

## Setting Up a Keyboard Shortcut

To streamline the process, you can set up a keyboard shortcut to run clip2drive whenever you copy content to your clipboard.

## Using Automator

 1. Open Automator:
 - Find Automator in your Applications folder or search for it using Spotlight.
 2. Create a New Service:
 - Click on File > New.
 - Choose Quick Action or Service (depends on your macOS version).
 3. Configure the Workflow:
 - At the top, set Workflow receives to no input in any application.
 4. Add a Run Shell Script Action:
 - In the Actions panel, search for Run Shell Script.
 - Drag it to the workflow area.
 5. Configure the Shell Script:
 - Set Shell to /bin/bash.
 - Pass input should be set to as arguments.
 - Enter the following script:
```shell
export PATH="$HOME/.bun/bin:$PATH"
/usr/local/bin/clip2drive >> ~/clip2drive.log 2>&1
```

(Adjust the path if you placed clip2drive elsewhere.)

 6. Save the Service:
 - Press Command + S or go to File > Save.
 - Name it something like clip2drive.

### llama3.2 (Ollama) Integration

clip2drive features integration with the llama3.2 model through Ollama, allowing for automated and intelligent generation of descriptive file names. This integration helps to make the uploaded notes more organized and identifiable by generating contextually meaningful names based on the content in your clipboard.

#### How It Works

  -  Automatic Name Generation: When clip2drive is run, it attempts to generate a more meaningful name for the clipboard content using llama3.2.
  -  API-Based Naming: The script interacts with the local Ollama API (http://localhost:11434/api/generate) to generate a name by providing the content as input.
  -  Dynamic File Names: If llama3.2 is installed and available, the generated name will be appended to the file name after the timestamp, resulting in file names such as:

For example, if the clipboard contains “Meeting notes for project X”, the generated file name might look like:

```
Note-2024-10-06-15-30-45-Meeting-Notes.md
```


#### Requirements for Ollama Integration

  -  Ollama Installed Locally: Ensure Ollama is installed and running locally.
  -  llama3.2 Model: You must have the llama3.2 model installed in Ollama.
  -  API Access: The Ollama REST API should be accessible at http://localhost:11434/api/generate for the integration to work.

#### Enabling the Integration

No additional configuration is required to enable the llama3.2 integration beyond installing Ollama and the llama3.2 model. When clip2drive runs, it will automatically:

  1.  Check if Ollama and llama3.2 are available.
  2.  If available, send the clipboard content to Ollama to generate a descriptive name for the file.

#### Fallback Behavior

If Ollama or the llama3.2 model is not available, or if the API fails to provide a valid response, clip2drive will default to naming the file without the additional description:

```
Note-YYYY-MM-DD-HH-MM-SS.md
```

This ensures that the process continues smoothly, even if Ollama is not accessible.

#### Example Workflow

  1.  Copy Content: Copy any content you want to save (e.g., meeting notes, to-do lists, summaries).
  2.  Run clip2drive: Use your configured hotkey or run the tool manually.
  3.  Automatic Name Generation: If Ollama is available, clip2drive will generate a descriptive name based on the clipboard content.
  4.  File Upload and Sharing: The generated file is uploaded to Google Drive, with permissions set to “Anyone with the link can view,” and the link is copied to your clipboard.

#### Benefits

  -  Meaningful File Names: The generated names make it easier to understand the content of each file at a glance, without needing to open it.
  -  Organized Drive: Avoids generic filenames, leading to a more organized Google Drive folder.
  -  Seamless Experience: No additional action is required from the user to benefit from this feature; it runs automatically when available.


### Assigning a Keyboard Shortcut

 1. Open System Preferences:
 - Go to Keyboard > Shortcuts > Services.
 2. Find Your Service:
 - Scroll down to the General section.
 - Find clip2drive (or whatever you named it).
 3. Add a Shortcut:
 - Click on none next to the service name.
 - Press your desired keyboard shortcut (e.g., Control + Shift + C).
 4. Test the Shortcut:
 - Copy some text to your clipboard.
 - Press your keyboard shortcut.
 - The tool should run, and the shareable link will be copied to your clipboard.

Note: Ensure the shortcut you choose doesn’t conflict with existing system or application shortcuts.

### Security Considerations

 - Protect Your .env File: Do not commit your .env file to any version control system.
 - OAuth Credentials: Keep your CLIENT_ID and CLIENT_SECRET confidential.
 - Token Storage:
 - The tool stores OAuth tokens in a token.json file.
 - Ensure token.json is added to your .gitignore file to prevent accidental commits.
 - For enhanced security, consider encrypting the token file.

### Troubleshooting

 - Authentication Errors:
 - If you receive errors during authentication, ensure your CLIENT_ID and CLIENT_SECRET are correct and that the Google Drive API is enabled.
 - Make sure the redirect URI (http://localhost:3000) is added to your OAuth client’s authorized redirect URIs.
 - Clipboard Issues:
 - Make sure you have text copied to your clipboard before running the tool.
 - Permission Errors:
 - Verify that your Google Drive folder ID is correct and that you have permission to upload files.
 - Port Conflicts:
 - If port 3000 is already in use, edit the index.js file and change the port to an available one.
 - Update the redirect URI in both the code and Google Cloud Console accordingly.

## Contributing

Contributions are welcome! Please open an issue or submit a pull request on the GitHub repository.

## License

This project is licensed under the MIT License. See the LICENSE file for details.

## Acknowledgements

 - [Bun.js](https://bun.sh/): A fast all-in-one JavaScript runtime.
 - [Google APIs Node.js Client](https://www.npmjs.com/package/googleapis): Provides access to Google APIs.
 - [clipboardy](https://www.npmjs.com/package/clipboardy): Access the system clipboard (copy/paste)
 - [open](https://www.npmjs.com/package/open): Open stuff like URLs, files, executables. Cross-platform.
 - [Automator](https://support.apple.com/en-gb/guide/automator/welcome/mac): A macOS application for automating tasks.
 - [llama3.2 (Ollama)](https://ollama.com/library/llama3.2): A language model for generating descriptive names based on content.

## Disclaimer: 
Be cautious with sharing permissions and ensure that you’re not uploading sensitive information to a publicly accessible location.